const { Parser } = require('flora-sql-parser');
const parser = new Parser();
const sql = `
SELECT  subcmpy_name AS 子公司名称
        ,store_name AS 门店名称
        ,store_code
        ,subcmpy_code
        ,sku_name AS sku名称
        ,sku_code
        ,item_id
        ,risk_type AS 已被诉_存在被诉风险
        ,suit_risk AS 涉诉风险类型
FROM    xxpt_fw_ads.ads_is_legal_ecom_risk_wrn_suit_df
WHERE   biz_type = '淘鲜达'AND mch_name = '大润发'
LIMIT   20
;
`
const sql2 = "select \n     case \n          when sum_type = 32+0 then cate_level3_id\n          when sum_type = 32+1 then cate_level2_id\n          when sum_type = 32+3 then cate_level1_id\n          when sum_type = 32+7 then biz_cate2\n          when sum_type = 32+15 then biz_cate1\n          when sum_type = 63 then merchant_code\n    end as     id   \n    ,case when sum_type = 32+0 then cate_level3_name\n          when sum_type = 32+1 then cate_level2_name\n          when sum_type = 32+3 then cate_level1_name\n          when sum_type = 32+7 then biz_cate2\n          when sum_type = 32+15 then biz_cate1\n          when sum_type = 63 then merchant_name\n    end as                         name\n    ,case \n          when sum_type = 32+0 then cate_level2_id\n          when sum_type = 32+1 then cate_level1_id\n          when sum_type = 32+3 then biz_cate2\n          when sum_type = 32+7 then biz_cate1\n          when sum_type = 32+15 then merchant_code\n          when sum_type = 63 then 'root'\n    end                as    parentId\n    ,case when sum_type = 32+0 then 6\n          when sum_type = 32+1 then 5\n          when sum_type = 32+3 then 4\n          when sum_type = 32+7 then 3\n          when sum_type = 32+15 then 2\n          when sum_type = 63 then 1\n    end                   as    level\n    ,case when sum_type = 32+0 then 'Y'\n          when sum_type = 32+1 then 'N'\n          when sum_type = 32+3 then 'N'\n          when sum_type = 32+7 then 'N'\n          when sum_type = 32+15 then 'N'\n          when sum_type = 63 then 'N'\n    end                    as    leaf\n    ,case when sum_type = 32+0 then 'Y'\n          when sum_type = 32+1 then 'Y'\n          when sum_type = 32+3 then 'Y'\n          when sum_type = 32+7 then 'Y'\n          when sum_type = 32+15 then 'Y'\n          when sum_type = 63 then 'Y'\n    end                as    expanded\n    ,stat_date                                     as \"统计日期\"\n    ,mtd_start_date                                as \"mtd开始日期\"\n    ,mtd_end_date                                  as \"mtd结束日期\"\n    ,mtd_start_date||'~'||mtd_end_date             as \"mtd起止日期\"\n    ,merchant_code                                 as \"商家编码\"\n    ,merchant_name                                 as \"商家名称\"\n    ,subsidiary_code                               as \"公司编码\"\n    ,subsidiary_name                               as \"公司名称\"\n    ,biz_cate1                                     as \"业务大类\"\n    ,biz_cate2                                     as \"业务小类\"\n    --时间进度\n    ,mtd_progress                                               \"时间进度\" \n    --所有门店\n    ,shop_cnt                                                   \"门店数\"\n    ,no_tax_rev_biz_amt_1d                                      \"未税营业收入1d\"\n    ,no_tax_rev_biz_amt_mtd                                     \"未税营业收入mtd\"\n    ,no_tax_gp_total_amt_mtd                                    \"未税毛利额mtd\"\n    ,no_tax_gp_total_rate_mtd                                   \"未税毛利率mtd\"\n\n    --考核门店\n\n    ,assessable_shop_cnt                                                   \"考核门店门店数\"--\n    ,no_tax_assessable_rev_biz_amt_1d                                      \"考核门店未税营业收入1d\"--\n    ,no_tax_assessable_gp_total_amt_1d                                     \"考核门店未税毛利额1d\"--\n    ,no_tax_assessable_gp_total_rate_1d                                    \"考核门店未税毛利率1d\"--\n    ,no_tax_assessable_rev_biz_amt_mtd                                     \"考核门店未税营业收入mtd\"\n    ,no_tax_bud_rev_biz_amt_cm                                             \"未税预算营业收入\"\n    ,no_tax_assessable_rev_biz_amt_acv_rate_mtd                            \"MTD营业收入达成率\" \n    ,no_tax_assessable_gp_total_amt_mtd                                    \"考核门店未税毛利额mtd\"--\n    ,no_tax_assessable_gp_total_rate_mtd                                   \"考核门店未税毛利率mtd\"\n    ,no_tax_bud_gp_total_rate_cm                                           \"未税预算毛利率\"\n    ,no_tax_assessable_gp_total_rate_acv_diff_amt_mtd                      \"MTD毛利率GAP\"\n   \n    ,benchmark_shop_cnt                                                    \"可比门店门店数\"--\n    ,no_tax_benchmark_rev_biz_amt_mtd                                      \"未税可比门店营业收入\"--\n    ,no_tax_benchmark_premth_rev_biz_amt_mtd                               \"未税可比门店营业收入环比值\"--\n    ,no_tax_benchmark_rev_biz_amt_mom                                      \"未税可比门店营业收入环比\"\n    ,no_tax_benchmark_gp_total_rate_mtd                                    \"未税可比门店毛利率\"--\n    ,no_tax_benchmark_premth_gp_total_rate_cm                              \"未税可比门店毛利率环比值\"--\n    ,no_tax_benchmark_gp_total_rate_mom                                    \"未税可比门店毛利率环比\"\n    --同比店\n    ,yoy_shop_cnt                                                    \"同比门店门店数\"--\n    ,no_tax_yoy_rev_biz_amt_mtd                                      \"未税同比门店营业收入\"--\n    ,no_tax_yoy_preyear_rev_biz_amt_mtd                              \"未税同比门店营业收入同比值\"--\n    ,no_tax_yoy_rev_biz_amt_yoy                                      \"未税同比门店营业收入同比\"\n    ,no_tax_yoy_gp_total_rate_cm                                     \"未税同比门店毛利率\"--\n    ,no_tax_yoy_preyear_gp_total_rate_cm                             \"未税同比门店毛利率同比值\"--\n    ,no_tax_yoy_gp_total_rate_yoy                                    \"未税同比门店毛利率同比\"\nfrom odps.hmads.ads_hm_fin_mng_cate_subs_cat3_mtd\nwhere ds = '${rpt_date:20190621}'\nand sum_type in (32,33,35,39,47,63)"
const sql3 = `SELECT t.stat_date AS 业务日期, t.merchant_code AS 集团CODE, t.merchant_name AS 集团, t.subsidiary_code AS 公司编码, t.subsidiary_name AS 公司名称\n\t, t.shop_code AS 门店Id, t.ou_code AS 门店编码, t.shop_name AS 门店名称, t.dept_code AS 部门code, t.dept_name AS 部门\n\t, t.cate_level1_id AS 一级类目code, t.cate_level1_name AS 一级类目名称, t.cate_level2_id AS 二级类目code, t.cate_level2_name AS 二级类目名称, t.cate_level3_id AS 三级类目code\n\t, t.cate_level3_name AS 三级类目名称, t.sku_code AS 商品code, t.sku_name AS 商品, t.is_union_sale_goods_desc AS 是否联营商品, t.is_handing_desc AS 是否加工品\n\t, t.supplier_id AS 供应商Id, t.supplier_code AS 供应商编码, t.supplier_name AS 供应商名称, t.brand_name AS 品牌名称, t.no_tax_rev_ord_amt_1d AS 未税销售原价\n\t, t.no_tax_rev_dsct_amt_1d AS 未税销售折扣, t.no_tax_rev_net_amt_1d AS 未税销售净额, t.no_tax_rev_rtn_amt_1d AS 未税退款金额, t.no_tax_rev_biz_amt_1d AS 未税营业收入, t.no_tax_online_rev_biz_amt_1d AS 未税线上营业收入\n\t, t.no_tax_offline_rev_biz_amt_1d AS 未税线下营业收入, t.no_tax_hmapp_rev_biz_amt_1d AS 未税盒马APP营业收入, t.no_tax_hmpos_rev_biz_amt_1d AS 未税盒马POS营业收入, t.no_tax_txd_rev_biz_amt_1d AS 未税淘鲜达营业收入, t.no_tax_wholesale_rev_biz_amt_1d AS 未税批发单营业收入\n\t, t.no_tax_group_rev_biz_amt_1d AS 未税团购营业收入, t.no_tax_cost_net_amt_1d AS 未税商品净成本, t.no_tax_sb_inv140_moving_amt_1d AS 未税生产加工中心B, t.no_tax_sa_inv050_moving_amt_1d AS 未税生产消耗, t.no_tax_sa_inv080_moving_amt_1d AS 未税生产\n\t, t.no_tax_sa_inv010_moving_amt_1d AS 未税大盘, t.no_tax_sa_inv020_moving_amt_1d AS 未税每日库调, t.no_tax_sa_inv030_moving_amt_1d AS 未税日常损耗, t.no_tax_sa_inv110_moving_amt_1d AS 未税退货报损, t.no_tax_sa_inv040_moving_amt_1d AS 未税商转礼\n\t, t.no_tax_sa_inv070_moving_amt_1d AS 未税行政领用, t.no_tax_sa_inv100_moving_amt_1d AS 未税试吃, t.no_tax_sa_inv060_moving_amt_1d AS 未税上架差异损耗, t.no_tax_total_loss_amt_1d AS 未税总商品损耗, t.no_tax_sa_inv120_moving_amt_1d AS 未税系统调整\n\t, t.no_tax_sa_inv130_moving_amt_1d AS 未税成本调整, t.no_tax_sb_inv150_moving_amt_1d AS 未税B品生产加回金额, t.no_tax_cost_total_amt_1d AS 未税总成本, t.no_tax_gp_itm_fg_amt_1d AS 未税商品前台毛利, t.no_tax_gp_bl_fg_amt_1d AS 未税损前前台毛利\n\t, t.no_tax_gp_al_fg_amt_1d AS 未税前台毛利, t.no_tax_gp_al_fg_rate_1d AS 未税前台毛利率, t.no_tax_contract_rebate_exp_stl_amt_1d AS 未税合同返利, t.no_tax_once_rebate_exp_stl_amt_1d AS 未税一次性返利, t.no_tax_gp_bg_amt_1d AS 未税返利金额\n\t, t.no_tax_gp_bg_rate_1d AS 未税后台毛利率, t.no_tax_gp_total_amt_1d AS 未税总毛利, t.no_tax_gp_total_rate_1d AS 未税总毛利率, t.no_tax_inv09003_moving_amt_1d AS 未税被动移库, t.no_tax_coupon_discount_amt_1d AS 折扣码未税优惠金额\n\t, t.rev_ord_cnt_1d AS 销售数量, s.pur_org_code AS 采购组织编码, s.pur_org_name AS 采购组织名称, s.parent_pur_org_code AS 一级采购组织编码, s.parent_pur_org_name AS 一级采购组织\nFROM (SELECT *\n\tFROM odps.hmads.rpt_hm_fin_shop_sku_dept_gross_profit_1d\n\tWHERE ds >= '20190924'\n\t\tAND ds <= '20190924'\n\t) t\n\tLEFT JOIN odps.hmcdm.dim_hm_supplier s ON s.ds = MAX_PT('odps.hmcdm.dim_hm_supplier')\n\t\tAND t.supplier_id = s.supplier_id\nLIMIT 180 OFFSET 0",
                "SELECT COUNT(*) AS COUNT FROM ( SELECT t.stat_date AS 业务日期, t.merchant_code AS 集团CODE, t.merchant_name AS 集团, t.subsidiary_code AS 公司编码, t.subsidiary_name AS 公司名称\n\t, t.shop_code AS 门店Id, t.ou_code AS 门店编码, t.shop_name AS 门店名称, t.dept_code AS 部门code, t.dept_name AS 部门\n\t, t.cate_level1_id AS 一级类目code, t.cate_level1_name AS 一级类目名称, t.cate_level2_id AS 二级类目code, t.cate_level2_name AS 二级类目名称, t.cate_level3_id AS 三级类目code\n\t, t.cate_level3_name AS 三级类目名称, t.sku_code AS 商品code, t.sku_name AS 商品, t.is_union_sale_goods_desc AS 是否联营商品, t.is_handing_desc AS 是否加工品\n\t, t.supplier_id AS 供应商Id, t.supplier_code AS 供应商编码, t.supplier_name AS 供应商名称, t.brand_name AS 品牌名称, t.no_tax_rev_ord_amt_1d AS 未税销售原价\n\t, t.no_tax_rev_dsct_amt_1d AS 未税销售折扣, t.no_tax_rev_net_amt_1d AS 未税销售净额, t.no_tax_rev_rtn_amt_1d AS 未税退款金额, t.no_tax_rev_biz_amt_1d AS 未税营业收入, t.no_tax_online_rev_biz_amt_1d AS 未税线上营业收入\n\t, t.no_tax_offline_rev_biz_amt_1d AS 未税线下营业收入, t.no_tax_hmapp_rev_biz_amt_1d AS 未税盒马APP营业收入, t.no_tax_hmpos_rev_biz_amt_1d AS 未税盒马POS营业收入, t.no_tax_txd_rev_biz_amt_1d AS 未税淘鲜达营业收入, t.no_tax_wholesale_rev_biz_amt_1d AS 未税批发单营业收入\n\t, t.no_tax_group_rev_biz_amt_1d AS 未税团购营业收入, t.no_tax_cost_net_amt_1d AS 未税商品净成本, t.no_tax_sb_inv140_moving_amt_1d AS 未税生产加工中心B, t.no_tax_sa_inv050_moving_amt_1d AS 未税生产消耗, t.no_tax_sa_inv080_moving_amt_1d AS 未税生产\n\t, t.no_tax_sa_inv010_moving_amt_1d AS 未税大盘, t.no_tax_sa_inv020_moving_amt_1d AS 未税每日库调, t.no_tax_sa_inv030_moving_amt_1d AS 未税日常损耗, t.no_tax_sa_inv110_moving_amt_1d AS 未税退货报损, t.no_tax_sa_inv040_moving_amt_1d AS 未税商转礼\n\t, t.no_tax_sa_inv070_moving_amt_1d AS 未税行政领用, t.no_tax_sa_inv100_moving_amt_1d AS 未税试吃, t.no_tax_sa_inv060_moving_amt_1d AS 未税上架差异损耗, t.no_tax_total_loss_amt_1d AS 未税总商品损耗, t.no_tax_sa_inv120_moving_amt_1d AS 未税系统调整\n\t, t.no_tax_sa_inv130_moving_amt_1d AS 未税成本调整, t.no_tax_sb_inv150_moving_amt_1d AS 未税B品生产加回金额, t.no_tax_cost_total_amt_1d AS 未税总成本, t.no_tax_gp_itm_fg_amt_1d AS 未税商品前台毛利, t.no_tax_gp_bl_fg_amt_1d AS 未税损前前台毛利\n\t, t.no_tax_gp_al_fg_amt_1d AS 未税前台毛利, t.no_tax_gp_al_fg_rate_1d AS 未税前台毛利率, t.no_tax_contract_rebate_exp_stl_amt_1d AS 未税合同返利, t.no_tax_once_rebate_exp_stl_amt_1d AS 未税一次性返利, t.no_tax_gp_bg_amt_1d AS 未税返利金额\n\t, t.no_tax_gp_bg_rate_1d AS 未税后台毛利率, t.no_tax_gp_total_amt_1d AS 未税总毛利, t.no_tax_gp_total_rate_1d AS 未税总毛利率, t.no_tax_inv09003_moving_amt_1d AS 未税被动移库, t.no_tax_coupon_discount_amt_1d AS 折扣码未税优惠金额\n\t, t.rev_ord_cnt_1d AS 销售数量, s.pur_org_code AS 采购组织编码, s.pur_org_name AS 采购组织名称, s.parent_pur_org_code AS 一级采购组织编码, s.parent_pur_org_name AS 一级采购组织\nFROM (SELECT *\n\tFROM odps.hmads.rpt_hm_fin_shop_sku_dept_gross_profit_1d\n\tWHERE ds >= '20190924'\n\t\tAND ds <= '20190924'\n\t) t\n\tLEFT JOIN odps.hmcdm.dim_hm_supplier s ON s.ds = MAX_PT('odps.hmcdm.dim_hm_supplier')\n\t\tAND t.supplier_id = s.supplier_id ) quark_t1`
const sql4 = 'select a from     b join c on a.key = b.key;'
const sql5 = "SELECT t.stat_date as  业务日期\n        ,t.merchant_code as  集团CODE\n        ,t.merchant_name as  集团\n        ,t.subsidiary_code as  公司编码\n        ,t.subsidiary_name as  公司名称\n        ,t.shop_code as  门店Id\n        ,t.ou_code as  门店编码\n        ,t.shop_name as  门店名称\n        ,t.dept_code as  部门code\n        ,t.dept_name as  部门\n        ,t.cate_level1_id as  一级类目code\n        ,t.cate_level1_name as  一级类目名称\n        ,t.cate_level2_id as  二级类目code\n        ,t.cate_level2_name as  二级类目名称\n        ,t.cate_level3_id as  三级类目code\n        ,t.cate_level3_name as  三级类目名称\n        ,t.sku_code as  商品code\n        ,t.sku_name as  商品\n        ,t.is_union_sale_goods_desc as  是否联营商品\n        ,t.is_handing_desc as  是否加工品\n        ,t.supplier_id as  供应商Id\n        ,t.supplier_code as  供应商编码\n        ,t.supplier_name as  供应商名称\n        ,t.brand_name as 品牌名称\n        ,t.no_tax_rev_ord_amt_1d as  未税销售原价\n        ,t.no_tax_rev_dsct_amt_1d as  未税销售折扣\n        ,t.no_tax_rev_net_amt_1d as  未税销售净额\n        ,t.no_tax_rev_rtn_amt_1d as  未税退款金额\n        ,t.no_tax_rev_biz_amt_1d as  未税营业收入\n        ,t.no_tax_online_rev_biz_amt_1d as  未税线上营业收入\n        ,t.no_tax_offline_rev_biz_amt_1d as  未税线下营业收入\n        ,t.no_tax_hmapp_rev_biz_amt_1d as  未税盒马APP营业收入\n        ,t.no_tax_hmpos_rev_biz_amt_1d as  未税盒马POS营业收入\n        ,t.no_tax_txd_rev_biz_amt_1d as  未税淘鲜达营业收入\n        ,t.no_tax_wholesale_rev_biz_amt_1d as  未税批发单营业收入\n        ,t.no_tax_group_rev_biz_amt_1d as  未税团购营业收入\n        ,t.no_tax_cost_net_amt_1d as  未税商品净成本\n        ,t.no_tax_sb_inv140_moving_amt_1d as  未税生产加工中心B\n        ,t.no_tax_sa_inv050_moving_amt_1d as  未税生产消耗\n        ,t.no_tax_sa_inv080_moving_amt_1d as  未税生产\n        ,t.no_tax_sa_inv010_moving_amt_1d as  未税大盘\n        ,t.no_tax_sa_inv020_moving_amt_1d as  未税每日库调\n        ,t.no_tax_sa_inv030_moving_amt_1d as  未税日常损耗\n        ,t.no_tax_sa_inv110_moving_amt_1d as  未税退货报损\n        ,t.no_tax_sa_inv040_moving_amt_1d as  未税商转礼\n        ,t.no_tax_sa_inv070_moving_amt_1d as  未税行政领用\n        ,t.no_tax_sa_inv100_moving_amt_1d as  未税试吃\n        ,t.no_tax_sa_inv060_moving_amt_1d as  未税上架差异损耗\n        ,t.no_tax_total_loss_amt_1d as  未税总商品损耗\n        ,t.no_tax_sa_inv120_moving_amt_1d as  未税系统调整\n        ,t.no_tax_sa_inv130_moving_amt_1d as  未税成本调整\n        ,t.no_tax_sb_inv150_moving_amt_1d as  未税B品生产加回金额\n        ,t.no_tax_cost_total_amt_1d as  未税总成本\n        ,t.no_tax_gp_itm_fg_amt_1d as  未税商品前台毛利\n        ,t.no_tax_gp_bl_fg_amt_1d as  未税损前前台毛利    \n        ,t.no_tax_gp_al_fg_amt_1d as  未税前台毛利\n        ,t.no_tax_gp_al_fg_rate_1d as  未税前台毛利率\n        ,t.no_tax_contract_rebate_exp_stl_amt_1d as  未税合同返利 \n        ,t.no_tax_once_rebate_exp_stl_amt_1d as  未税一次性返利\n        ,t.no_tax_gp_bg_amt_1d as  未税返利金额 \n        ,t.no_tax_gp_bg_rate_1d as  未税后台毛利率\n        ,t.no_tax_gp_total_amt_1d as  未税总毛利\n        ,t.no_tax_gp_total_rate_1d as  未税总毛利率\n        ,t.no_tax_inv09003_moving_amt_1d as  未税被动移库\n        ,t.no_tax_coupon_discount_amt_1d as  折扣码未税优惠金额\n        ,t.rev_ord_cnt_1d as  销售数量\n        ,s.pur_org_code as 采购组织编码\n        ,s.pur_org_name as 采购组织名称\n\t\t,s.parent_pur_org_code as 一级采购组织编码\n        ,s.parent_pur_org_name as 一级采购组织\nFROM(\n  select *\n  from odps.hmads.rpt_hm_fin_shop_sku_dept_gross_profit_1d\n  where ds>='${date_start:20190924}' \n  and ds<='${date_end:20190924}'\n) t\nleft outer join odps.hmcdm.dim_hm_supplier s\non s.ds = MAX_PT('odps.hmcdm.dim_hm_supplier') \nand t.supplier_id = s.supplier_id;"
// console.log(sql.match(/(?:from|FROM|join|union)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/))
// console.log(sql2.match(/(?:from|FROM|join|union)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/))
// console.log(sql3.match(/(?:from|FROM|join|union)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/g))
const matchs = sql4.match(/(?:from|FROM|join|union)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/g)
console.log(matchs.map( s => s.match( /(?:from|FROM|join|union)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/ )[1]))
console.log()
// console.log(sql5.match(/(?:from|FROM|join|JOIN|union|UNION)\s+(?:[a-z]+\.)?([a-zA-Z0-9_\.]+)/g))